# MP-02 Protocol Module

The MP-02 module implements the Effort Receipt Protocol.

## Overview

The MP-02 protocol provides cryptographic receipts for effort, enabling:

- Transparent work tracking
- Tamper-evident audit trails
- Privacy-preserving verification

## Observer

Captures raw effort signals.

::: intentlog.mp02.observer.TextObserver
    options:
      show_root_heading: true

::: intentlog.mp02.observer.ObserverConfig
    options:
      show_root_heading: true

## Signal

Raw effort signals.

::: intentlog.mp02.signal.Signal
    options:
      show_root_heading: true

::: intentlog.mp02.signal.SignalType
    options:
      show_root_heading: true

## Segmentation

Groups signals into effort segments.

::: intentlog.mp02.segmentation.SegmentationEngine
    options:
      show_root_heading: true

::: intentlog.mp02.segmentation.EffortSegment
    options:
      show_root_heading: true

## Receipt

Cryptographic effort receipts.

::: intentlog.mp02.receipt.Receipt
    options:
      show_root_heading: true

::: intentlog.mp02.receipt.ReceiptBuilder
    options:
      show_root_heading: true

::: intentlog.mp02.receipt.verify_receipt
    options:
      show_root_heading: true

## Ledger

Append-only receipt ledger.

::: intentlog.mp02.ledger.Ledger
    options:
      show_root_heading: true
      members:
        - append
        - read_entries
        - verify_chain
        - export
        - get_stats

## Usage Examples

### Observation Session

```python
from intentlog.mp02.observer import TextObserver, ObserverConfig

# Start observation
config = ObserverConfig(capture_modality="file_watcher")
observer = TextObserver(paths=["src/"], config=config)
observer.start()

# ... work happens ...

# Stop and get signals
signals = observer.stop()
```

### Receipt Generation

```python
from intentlog.mp02.segmentation import SegmentationEngine, SegmentationRule
from intentlog.mp02.validator import Validator
from intentlog.mp02.receipt import ReceiptBuilder

# Segment signals
rule = SegmentationRule(time_window_minutes=30)
engine = SegmentationEngine(rule)
segments = engine.segment(signals)

# Validate and build receipts
validator = Validator()
for segment in segments:
    validation = validator.validate(segment)

    receipt = (ReceiptBuilder()
        .from_segment(segment)
        .with_validation(validation)
        .build())

    print(f"Receipt: {receipt.receipt_hash[:8]}")
    print(f"Confidence: {validation.confidence:.2f}")
```

### Ledger Management

```python
from intentlog.mp02.ledger import Ledger

ledger = Ledger(Path(".intentlog/ledger"))

# Append receipt
entry = ledger.append(receipt)
print(f"Entry #{entry.sequence}")

# Verify chain
report = ledger.verify_chain()
if report['verified']:
    print("Ledger integrity verified")
else:
    print(f"Errors: {report['errors']}")

# Get statistics
stats = ledger.get_stats()
print(f"Entries: {stats['entry_count']}")
```

## Protocol Specification

For the complete MP-02 specification, see [mp-02-spec.md](../guide/mp02.md).

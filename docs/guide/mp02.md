# MP-02 Protocol

The MP-02 Effort Receipt Protocol provides cryptographic proof of effort.

## Overview

MP-02 enables transparent work tracking through:

1. **Signal Capture**: Observing work artifacts
2. **Segmentation**: Grouping effort periods
3. **Validation**: Verifying effort legitimacy
4. **Receipt Generation**: Creating cryptographic proofs
5. **Ledger Anchoring**: Immutable record keeping

## Workflow

### 1. Start Observation

```bash
# Start observing files
ilog observe start src/ tests/

# Check status
ilog observe status
```

### 2. Mark Milestones

```bash
# Add segment markers as you work
ilog segment mark "Completed initial design"
ilog segment mark --category decision "Chose Redis for caching"
ilog segment mark --category note "Need to review auth flow"
```

### 3. Stop and Generate Receipts

```bash
# Stop observation
ilog observe stop

# Generate receipts from signals
ilog receipt create
```

### 4. View and Verify

```bash
# List receipts
ilog receipt list

# Show specific receipt
ilog receipt show abc123

# Verify receipt
ilog receipt verify abc123
```

## Ledger Management

### View Ledger

```bash
ilog ledger show
ilog ledger stats
```

### Verify Integrity

```bash
ilog ledger verify
```

### Export for Audit

```bash
ilog ledger export --output audit.log
```

### Create Checkpoint

```bash
ilog ledger checkpoint
```

## Receipt Structure

Each receipt contains:

```json
{
  "receipt_id": "uuid",
  "receipt_hash": "sha256...",
  "start_time": "2025-01-01T10:00:00Z",
  "end_time": "2025-01-01T12:00:00Z",
  "signal_hashes": ["hash1", "hash2", ...],
  "summary": "Implemented user authentication",
  "confidence": 0.95,
  "validation_metadata": {
    "provider": "rule_based",
    "model_name": "validator_v1"
  }
}
```

## Privacy Controls (Section 12)

MP-02 Section 12 defines privacy requirements:

### Encryption

```bash
# Encrypt sensitive intents
ilog privacy encrypt
```

### Revocation

```bash
# Revoke future observation
ilog privacy revoke --reason "Privacy request"

# Revoke specific intent
ilog privacy revoke --target intent --target-id abc123
```

### Key Points

1. **Raw signals MAY be encrypted**
2. **Receipts MUST NOT expose raw content**
3. **Humans MAY revoke future observation**
4. **Past receipts remain immutable**

## Verification

### Full Verification

```bash
ilog verify all
```

Output:
```
Verifying IntentLog integrity...

1. Ledger chain...
   PASSED (42 entries)

2. Receipts...
   38 passed, 0 failed

========================================
Overall: PASSED
```

### Targeted Verification

```bash
# Ledger only
ilog verify ledger

# All receipts
ilog verify receipts

# Specific receipt
ilog verify abc123
```

## Python API

```python
from intentlog.mp02.observer import TextObserver, ObserverConfig
from intentlog.mp02.segmentation import SegmentationEngine
from intentlog.mp02.receipt import ReceiptBuilder
from intentlog.mp02.ledger import Ledger

# Observe
config = ObserverConfig()
observer = TextObserver(paths=["src/"], config=config)
observer.start()
# ... work ...
signals = observer.stop()

# Segment
engine = SegmentationEngine()
segments = engine.segment(signals)

# Generate receipts
for segment in segments:
    receipt = ReceiptBuilder().from_segment(segment).build()
    ledger.append(receipt)
```

## Specification

For the complete normative specification, see the [MP-02 Specification](../mp-02-spec.md).
